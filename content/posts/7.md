+++
title = '安価な RA4M1 マイコンを Arduino Uno R4 の代わりに使ってみる　その１'
date = 2023-10-24T11:49:04+09:00
tags = [ 'arduino' , 'ra4m1' , 'arm' ]
draft = true
+++
1000円で買える RA4M1 マイコンを Arduino として使えるか試してみました。

# 概要

今回のターゲットは [WeAct Studio の RA4M1 Core Board](https://ja.aliexpress.com/item/1005006103872563.html)です。
送料別で 1000 円未満で変えると思います。
5V 版と 3.3V 版がありますが、今回入手したのは 5V 版です。
~~基板上の違いは LDO だけだと思います。~~



Arduino Uno R4 で採用された Renesas の RA4M1 マイコンを積んだマイコンボードです。
RA4M1 は単体で買ってもそれなりの値段になるので、かなりオトクなボードだと思います。<br>

いっぽう Arduino Uno R4 Minima は、日本では 3000円程度で売られています。
最近中華互換機がいくつか出てきましたが、それでも 2000円くらいします。
1000 円のマイコンボードが Uno R4 の代わりになるならコスパ最高ということで、
いろいろ試してみたいと思います。

# Arduino Uno R4 Minima との違い

Arduino Uno R4 Minima は、Wifi のついていない廉価版です。(技適の問題もありませんし…)
[回路図](https://docs.arduino.cc/resources/schematics/ABX00080-schematics.pdf)を見てもらえばわかりますが、
ほぼ RA4M1 マイコン単体の機能で実現しています。
Uno R3 などと違って USB もマイコンに直接接続されていますし、
外部クロックなども省略されています。<br>

いっぽう[RA4M1 Core board](https://github.com/WeActStudio/WeActStudio.RA4M1_64Pin_CoreBoard/blob/master/Hardware/WeAct-RA4M1_CoreBoard_V10%20SchDoc.pdf)も 
RA4M1 マイコンの信号を素直に外部に引き出す構成になっています。
ほぼ同じ構成ということができるでしょう。<br>

違いは以下の通りです。

- 物理的に形状が違うので、Arduino 用のシールドはそのまま接続できない(当たり前か…)
- 外部クロック(MOSC/SOSC)が接続されている
- Ardiono で使わないピンもピンヘッダに引き出されている
- 電源は 5V または 3.3V のどちらかのみ対応
- AREF 周りの回路が違う

外部クロックは、ソフトウェアで明示的にオンにしなければ使用されないので、
Uno R4 用に作られたコードがそのまま内部クロックで動作するものと思われます。<br>

というか、MOSCとして 16MHz のクリスタルがついているのですけど、PLL の入力周波数上限 12.5MHz を超えているので、
周辺機器に安定したクロックを供給する目的に使うものなのですかね…
Uno R4 にも基板上はクリスタルを接続する場所自体はありますし。
その割には USB は内部クロックで動作しているようですし。
謎だ…

# Arduino IDE の準備

Arduino IDE のボードマネージャで `Arduino Uno R4 Boards` をインストールします。
ついでにドライバもインストールされます。

# ブートローダを書き込む

RA4M1 Core board には当然 Arduino のブートローダが書き込まれていません。
[Uno R4 Minima Cheet sheet](https://docs.arduino.cc/tutorials/uno-r4-minima/cheat-sheet) にブートローダの復元方法が書かれているので、
これに従ってブートローダを書き込みます。

# L チカする

Arduino のサンプルコードの Blink をそのまま書き込んでみます。
Blink は Arduino のボードについている LED を点滅させます。
大抵は D13 に接続されています。
D13のピンは RA4M1 マイコンでいえば P111 なので、ここに LED を接続します。

# USB キーボードにしてみる

Uno R4 の追加機能ということで USB を使ってみます。
