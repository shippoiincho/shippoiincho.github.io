+++
title = 'MZ-1500 に QD エミュレータを接続する'
date = 2025-10-13T16:16:36+09:00
tags =  [ 'retropc' ]
+++
Gotek を MZ-1500 で動かすためのまとめ

# はじめに

SMC-777 に続いて MZ-1500 です。
MZ-1500 には外部記憶装置として QuickDisk (QD) が搭載されています。
QD は容量 64KB のフロッピーディスクのような形状をしています。
しかし、フロッピーディスクとはことなりトラックなどに分かれておらず、全体が一つのトラックとして扱われます。
また、読み書きに必ず 8 秒ほどかかるという特徴があります。

一般的にはファミコンンのディスクシステムが QD とほぼ同じものとなっています。

GOTEK は以前も扱った通り、一般的には FDD のエミュレータとして用います。
[FlashFloppy](https://github.com/keirf/flashfloppy) には QD のエミュレーション用のファームウェアが存在していて、
QD の代わりに使うことが可能です。

今回は MZ-1500 の QD の代わりに GOTEK w/FlashFloppy を接続してみます。

# 設定＆接続

MZ-1500 と GOTEK の接続は、以下の説明を参考にします。
https://github.com/keirf/flashfloppy/wiki/Quick-Disk
この中の 10Pin Interface の説明に従って、変換ケーブルを作成します。

![Conversion connector](/images/mz1500qd00.jpg)

本体にマウントするためのマウンタは[こちら](https://booth.pm/ja/items/6046867?srsltid=AfmBOooDCn_T07yQpNpHudJS5vWdntk0wX3gU8mMYwTunlE6qHzL17hH)を使用しました。
先人がいるから簡単だと思ったんだよね…。

![MZ1500 with GOTEK](/images/mz1500qd01.png)

# イメージの作成

普通はこの状態で、FlashFloppy のファームウェアに同梱されている Blank.qd を使ってフォーマットを行うのですが、
本体の調子が悪いのか、フォーマットや書き込みがうまくいきませんでした。

そこで、強引にエミュレータで使用されている QDF ファイルから QD ファイルを作成することにしました。
QDF ファイルは、QD のイメージの情報をほぼそのまま持っているので、これを MFM でエンコードして QD 化します。

QD ファイルは先頭の 16 バイトヘッダ以降は、ほぼ QD の信号をそのまま LSB-First で記録しているようです。

- ベースは FlashFloppy 付属の `Blank.qd` を使う
- データは QDF ファイルを LSB-First で MFM エンコードする
- データの位置を調整してベースファイルに埋め込む

この方法で、QD ファイルを作成します。
プロテクトがかかっている QDF ファイルもそのままエンコードしているので、
原理的にはそのまま QD 化が可能です。

[超いい加減ツール](https://github.com/shippoiincho/qdf2qd)を作成しましたので、お試しください。

# まとめ

- MZ-1500 の QuickDisk を GOTEK/FlashFloppy 化した
- GOTEK/FF で使う QD ファイルに変換するツールも作ったよ

